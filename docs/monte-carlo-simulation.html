<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Monte Carlo Simulation | Sports Analytics</title>
  <meta name="description" content="Chapter 4 Monte Carlo Simulation | Sports Analytics Notes" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Monte Carlo Simulation | Sports Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://aaron-nielsen.github.io/SportsAnalyticsBook/images/csu.png" />
  <meta property="og:description" content="Chapter 4 Monte Carlo Simulation | Sports Analytics Notes" />
  <meta name="github-repo" content="aaron-nielsen.github.io/SportsAnalyticsBook/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Monte Carlo Simulation | Sports Analytics" />
  
  <meta name="twitter:description" content="Chapter 4 Monte Carlo Simulation | Sports Analytics Notes" />
  <meta name="twitter:image" content="https://aaron-nielsen.github.io/SportsAnalyticsBook/images/csu.png" />

<meta name="author" content="Aaron Nielsen, Department of Statistics, Colorado State University" />


<meta name="date" content="2022-07-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="probability.html"/>
<link rel="next" href="statistical-inference.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sports Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i><b>1</b> Getting Started With R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#some-r-basics"><i class="fa fa-check"></i><b>1.2</b> Some R Basics</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#descriptive-statistics"><i class="fa fa-check"></i><b>2.1</b> Descriptive Statistics</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#definitions"><i class="fa fa-check"></i><b>2.1.1</b> Definitions</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#descriptive-statistics-1"><i class="fa fa-check"></i><b>2.1.2</b> Descriptive Statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizations"><i class="fa fa-check"></i><b>2.2</b> Visualizations</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#histograms"><i class="fa fa-check"></i><b>2.2.1</b> Histograms</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#bar-plots"><i class="fa fa-check"></i><b>2.2.2</b> Bar Plots</a></li>
<li class="chapter" data-level="2.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#scatter-plots"><i class="fa fa-check"></i><b>2.2.3</b> Scatter Plots</a></li>
<li class="chapter" data-level="2.2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#kable-tables"><i class="fa fa-check"></i><b>2.2.4</b> Kable Tables</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#baseball"><i class="fa fa-check"></i><b>2.3</b> Baseball</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#hitting-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Hitting Statistics</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#pitching-statistics"><i class="fa fa-check"></i><b>2.3.2</b> Pitching Statistics</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#wins-above-replacement"><i class="fa fa-check"></i><b>2.3.3</b> Wins Above Replacement</a></li>
<li class="chapter" data-level="2.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#calculating-hitting-statistics"><i class="fa fa-check"></i><b>2.3.4</b> Calculating Hitting Statistics</a></li>
<li class="chapter" data-level="2.3.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#evaluating-pitching-statistics"><i class="fa fa-check"></i><b>2.3.5</b> Evaluating Pitching Statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#football"><i class="fa fa-check"></i><b>2.4</b> Football</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#basic-football-statistics"><i class="fa fa-check"></i><b>2.4.1</b> Basic Football Statistics</a></li>
<li class="chapter" data-level="2.4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#advanced-football-statistics"><i class="fa fa-check"></i><b>2.4.2</b> Advanced Football Statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#basketball"><i class="fa fa-check"></i><b>2.5</b> Basketball</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#basic-basketball-statistics"><i class="fa fa-check"></i><b>2.5.1</b> Basic Basketball Statistics</a></li>
<li class="chapter" data-level="2.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#advanced-basketball-statistics"><i class="fa fa-check"></i><b>2.5.2</b> Advanced Basketball Statistics</a></li>
<li class="chapter" data-level="2.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#four-factors"><i class="fa fa-check"></i><b>2.5.3</b> Four Factors</a></li>
<li class="chapter" data-level="2.5.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#shot-charts"><i class="fa fa-check"></i><b>2.5.4</b> Shot Charts</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#hockey"><i class="fa fa-check"></i><b>2.6</b> Hockey</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#basic-hockey-statistics"><i class="fa fa-check"></i><b>2.6.1</b> Basic Hockey Statistics</a></li>
<li class="chapter" data-level="2.6.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#advanced-hockey-statistics"><i class="fa fa-check"></i><b>2.6.2</b> Advanced Hockey Statistics</a></li>
<li class="chapter" data-level="2.6.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#actual-vs.-expected-goals"><i class="fa fa-check"></i><b>2.6.3</b> Actual vs. Expected Goals</a></li>
<li class="chapter" data-level="2.6.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#goalie-statistics"><i class="fa fa-check"></i><b>2.6.4</b> Goalie Statistics</a></li>
<li class="chapter" data-level="2.6.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#correlation-plots"><i class="fa fa-check"></i><b>2.6.5</b> Correlation Plots</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#volleyball"><i class="fa fa-check"></i><b>2.7</b> Volleyball</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#basic-volleyball-statistics"><i class="fa fa-check"></i><b>2.7.1</b> Basic Volleyball Statistics</a></li>
<li class="chapter" data-level="2.7.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#scatter-plot"><i class="fa fa-check"></i><b>2.7.2</b> Scatter Plot</a></li>
<li class="chapter" data-level="2.7.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#box-plot"><i class="fa fa-check"></i><b>2.7.3</b> Box Plot</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#soccer"><i class="fa fa-check"></i><b>2.8</b> Soccer</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#basic-soccer-statistics"><i class="fa fa-check"></i><b>2.8.1</b> Basic Soccer Statistics</a></li>
<li class="chapter" data-level="2.8.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#advanced-soccer-statistics"><i class="fa fa-check"></i><b>2.8.2</b> Advanced Soccer Statistics</a></li>
<li class="chapter" data-level="2.8.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#bar-plot"><i class="fa fa-check"></i><b>2.8.3</b> Bar Plot</a></li>
<li class="chapter" data-level="2.8.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#scatter-plot-1"><i class="fa fa-check"></i><b>2.8.4</b> Scatter Plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>3</b> Probability</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probability.html"><a href="probability.html#definitions-1"><i class="fa fa-check"></i><b>3.1</b> Definitions</a></li>
<li class="chapter" data-level="3.2" data-path="probability.html"><a href="probability.html#set-theory"><i class="fa fa-check"></i><b>3.2</b> Set Theory</a></li>
<li class="chapter" data-level="3.3" data-path="probability.html"><a href="probability.html#axioms-properties-and-laws"><i class="fa fa-check"></i><b>3.3</b> Axioms, Properties, and Laws</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="probability.html"><a href="probability.html#axioms-of-probability"><i class="fa fa-check"></i><b>3.3.1</b> Axioms of Probability</a></li>
<li class="chapter" data-level="3.3.2" data-path="probability.html"><a href="probability.html#properties-of-probability"><i class="fa fa-check"></i><b>3.3.2</b> Properties of Probability</a></li>
<li class="chapter" data-level="3.3.3" data-path="probability.html"><a href="probability.html#laws-of-probability"><i class="fa fa-check"></i><b>3.3.3</b> Laws of Probability</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="probability.html"><a href="probability.html#combinatorics"><i class="fa fa-check"></i><b>3.4</b> Combinatorics</a></li>
<li class="chapter" data-level="3.5" data-path="probability.html"><a href="probability.html#odds-and-gambling"><i class="fa fa-check"></i><b>3.5</b> Odds and Gambling</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probability.html"><a href="probability.html#sports-betting-in-usa"><i class="fa fa-check"></i><b>3.5.1</b> Sports Betting in USA</a></li>
<li class="chapter" data-level="3.5.2" data-path="probability.html"><a href="probability.html#gambling-addiction"><i class="fa fa-check"></i><b>3.5.2</b> Gambling Addiction</a></li>
<li class="chapter" data-level="3.5.3" data-path="probability.html"><a href="probability.html#odds-definition"><i class="fa fa-check"></i><b>3.5.3</b> Odds Definition</a></li>
<li class="chapter" data-level="3.5.4" data-path="probability.html"><a href="probability.html#gambling-odds"><i class="fa fa-check"></i><b>3.5.4</b> Gambling Odds</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="probability.html"><a href="probability.html#random-variables"><i class="fa fa-check"></i><b>3.6</b> Random Variables</a></li>
<li class="chapter" data-level="3.7" data-path="probability.html"><a href="probability.html#common-random-variables"><i class="fa fa-check"></i><b>3.7</b> Common Random Variables</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="probability.html"><a href="probability.html#binomial-rvs"><i class="fa fa-check"></i><b>3.7.1</b> Binomial RVs</a></li>
<li class="chapter" data-level="3.7.2" data-path="probability.html"><a href="probability.html#geometric-rvs"><i class="fa fa-check"></i><b>3.7.2</b> Geometric RVs</a></li>
<li class="chapter" data-level="3.7.3" data-path="probability.html"><a href="probability.html#poisson-rvs"><i class="fa fa-check"></i><b>3.7.3</b> Poisson RVs</a></li>
<li class="chapter" data-level="3.7.4" data-path="probability.html"><a href="probability.html#negative-binomial-rvs"><i class="fa fa-check"></i><b>3.7.4</b> Negative Binomial RVs</a></li>
<li class="chapter" data-level="3.7.5" data-path="probability.html"><a href="probability.html#normal-rvs"><i class="fa fa-check"></i><b>3.7.5</b> Normal RVs</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="probability.html"><a href="probability.html#case-study-nfl-state-values-and-decision-making"><i class="fa fa-check"></i><b>3.8</b> Case Study: NFL state values and decision making</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html"><i class="fa fa-check"></i><b>4</b> Monte Carlo Simulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#basics"><i class="fa fa-check"></i><b>4.1</b> Basics</a></li>
<li class="chapter" data-level="4.2" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#estimating-probabilities"><i class="fa fa-check"></i><b>4.2</b> Estimating Probabilities</a></li>
<li class="chapter" data-level="4.3" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#simulating-streaks"><i class="fa fa-check"></i><b>4.3</b> Simulating Streaks</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#winning-streak-simulation"><i class="fa fa-check"></i><b>4.3.1</b> Winning Streak Simulation</a></li>
<li class="chapter" data-level="4.3.2" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#hitting-streak-simulation"><i class="fa fa-check"></i><b>4.3.2</b> Hitting Streak Simulation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#gambling-simulations"><i class="fa fa-check"></i><b>4.4</b> Gambling Simulations</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#martingale-system"><i class="fa fa-check"></i><b>4.4.1</b> Martingale System</a></li>
<li class="chapter" data-level="4.4.2" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#gamblers-ruin"><i class="fa fa-check"></i><b>4.4.2</b> Gambler’s Ruin</a></li>
<li class="chapter" data-level="4.4.3" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#simulating-a-winning-system"><i class="fa fa-check"></i><b>4.4.3</b> Simulating a Winning System</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="monte-carlo-simulation.html"><a href="monte-carlo-simulation.html#case-study-evaluating-hitters"><i class="fa fa-check"></i><b>4.5</b> Case Study: Evaluating Hitters</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i><b>5</b> Statistical Inference</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistical-inference.html"><a href="statistical-inference.html#defining-a-population-in-sports-data"><i class="fa fa-check"></i><b>5.1</b> Defining a Population in Sports Data</a></li>
<li class="chapter" data-level="5.2" data-path="statistical-inference.html"><a href="statistical-inference.html#margin-of-error-calcuations"><i class="fa fa-check"></i><b>5.2</b> Margin of Error Calcuations</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="statistical-inference.html"><a href="statistical-inference.html#moe-for-probabilities"><i class="fa fa-check"></i><b>5.2.1</b> MOE for Probabilities</a></li>
<li class="chapter" data-level="5.2.2" data-path="statistical-inference.html"><a href="statistical-inference.html#moe-for-averages"><i class="fa fa-check"></i><b>5.2.2</b> MOE for Averages</a></li>
<li class="chapter" data-level="5.2.3" data-path="statistical-inference.html"><a href="statistical-inference.html#moe-estimation-using-simulation"><i class="fa fa-check"></i><b>5.2.3</b> MOE estimation using simulation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="statistical-inference.html"><a href="statistical-inference.html#one-sample-and-two-sample-t-tests-and-confidence-intervals"><i class="fa fa-check"></i><b>5.3</b> One Sample and Two Sample t-tests and confidence intervals</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="statistical-inference.html"><a href="statistical-inference.html#hockey-faceoffs"><i class="fa fa-check"></i><b>5.3.1</b> Hockey Faceoffs</a></li>
<li class="chapter" data-level="5.3.2" data-path="statistical-inference.html"><a href="statistical-inference.html#hockey-penalty-scoring"><i class="fa fa-check"></i><b>5.3.2</b> Hockey Penalty Scoring</a></li>
<li class="chapter" data-level="5.3.3" data-path="statistical-inference.html"><a href="statistical-inference.html#nfl-overtime-winners"><i class="fa fa-check"></i><b>5.3.3</b> NFL Overtime Winners</a></li>
<li class="chapter" data-level="5.3.4" data-path="statistical-inference.html"><a href="statistical-inference.html#icing-the-kicker"><i class="fa fa-check"></i><b>5.3.4</b> Icing the Kicker</a></li>
<li class="chapter" data-level="5.3.5" data-path="statistical-inference.html"><a href="statistical-inference.html#example-football-one-vs.-two-point-conversion"><i class="fa fa-check"></i><b>5.3.5</b> Example: Football One vs. Two Point Conversion</a></li>
<li class="chapter" data-level="5.3.6" data-path="statistical-inference.html"><a href="statistical-inference.html#two-sample-tests"><i class="fa fa-check"></i><b>5.3.6</b> Two Sample Tests</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="statistical-inference.html"><a href="statistical-inference.html#permutation-tests"><i class="fa fa-check"></i><b>5.4</b> Permutation Tests</a></li>
<li class="chapter" data-level="5.5" data-path="statistical-inference.html"><a href="statistical-inference.html#bootstrap"><i class="fa fa-check"></i><b>5.5</b> Bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="correlation.html"><a href="correlation.html"><i class="fa fa-check"></i><b>6</b> Correlation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="correlation.html"><a href="correlation.html#pearsons-correlation-coefficient"><i class="fa fa-check"></i><b>6.1</b> Pearson’s Correlation Coefficient</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="correlation.html"><a href="correlation.html#partial-correlation-and-confounding-variables"><i class="fa fa-check"></i><b>6.1.1</b> Partial Correlation and Confounding Variables</a></li>
<li class="chapter" data-level="6.1.2" data-path="correlation.html"><a href="correlation.html#properties-of-the-linear-correlation-coefficient"><i class="fa fa-check"></i><b>6.1.2</b> Properties of the Linear Correlation Coefficient</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="correlation.html"><a href="correlation.html#rank-correlation"><i class="fa fa-check"></i><b>6.2</b> Rank Correlation</a></li>
<li class="chapter" data-level="6.3" data-path="correlation.html"><a href="correlation.html#autocorrelation"><i class="fa fa-check"></i><b>6.3</b> Autocorrelation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="correlation.html"><a href="correlation.html#hot-hand"><i class="fa fa-check"></i><b>6.3.1</b> Hot Hand</a></li>
<li class="chapter" data-level="6.3.2" data-path="correlation.html"><a href="correlation.html#streakiness-in-sports"><i class="fa fa-check"></i><b>6.3.2</b> Streakiness in Sports</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="correlation.html"><a href="correlation.html#association-of-categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Association of Categorical Variables</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>7</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="linear-regression.html"><a href="linear-regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>7.1</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="linear-regression.html"><a href="linear-regression.html#pythagorean-records"><i class="fa fa-check"></i><b>7.1.1</b> Pythagorean Records</a></li>
<li class="chapter" data-level="7.1.2" data-path="linear-regression.html"><a href="linear-regression.html#regression-to-the-mean"><i class="fa fa-check"></i><b>7.1.2</b> Regression to the Mean</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="linear-regression.html"><a href="linear-regression.html#variable-transformations"><i class="fa fa-check"></i><b>7.2</b> Variable Transformations</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="linear-regression.html"><a href="linear-regression.html#draft-pick-values"><i class="fa fa-check"></i><b>7.2.1</b> Draft Pick Values</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="linear-regression.html"><a href="linear-regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>7.3</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="linear-regression.html"><a href="linear-regression.html#four-factors-and-winning"><i class="fa fa-check"></i><b>7.3.1</b> Four Factors and Winning</a></li>
<li class="chapter" data-level="7.3.2" data-path="linear-regression.html"><a href="linear-regression.html#linear-weights-in-baseball"><i class="fa fa-check"></i><b>7.3.2</b> Linear Weights in Baseball</a></li>
<li class="chapter" data-level="7.3.3" data-path="linear-regression.html"><a href="linear-regression.html#pass-air-yards-regression"><i class="fa fa-check"></i><b>7.3.3</b> Pass Air Yards Regression</a></li>
<li class="chapter" data-level="7.3.4" data-path="linear-regression.html"><a href="linear-regression.html#epl-passing-and-scoring"><i class="fa fa-check"></i><b>7.3.4</b> EPL Passing and Scoring</a></li>
<li class="chapter" data-level="7.3.5" data-path="linear-regression.html"><a href="linear-regression.html#hockey-ppg-vs-toi"><i class="fa fa-check"></i><b>7.3.5</b> Hockey PPG vs TOI</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="linear-regression.html"><a href="linear-regression.html#issues-with-multiyear-data"><i class="fa fa-check"></i><b>7.4</b> Issues with Multiyear Data</a></li>
<li class="chapter" data-level="7.5" data-path="linear-regression.html"><a href="linear-regression.html#interaction"><i class="fa fa-check"></i><b>7.5</b> Interaction</a></li>
<li class="chapter" data-level="7.6" data-path="linear-regression.html"><a href="linear-regression.html#confounding-variables"><i class="fa fa-check"></i><b>7.6</b> Confounding Variables</a></li>
<li class="chapter" data-level="7.7" data-path="linear-regression.html"><a href="linear-regression.html#logistic-regression"><i class="fa fa-check"></i><b>7.7</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="linear-regression.html"><a href="linear-regression.html#sack-and-interception-probability-models"><i class="fa fa-check"></i><b>7.7.1</b> Sack and Interception Probability Models</a></li>
<li class="chapter" data-level="7.7.2" data-path="linear-regression.html"><a href="linear-regression.html#soccer-goal-logistic-model"><i class="fa fa-check"></i><b>7.7.2</b> Soccer Goal Logistic Model</a></li>
<li class="chapter" data-level="7.7.3" data-path="linear-regression.html"><a href="linear-regression.html#field-goal-success"><i class="fa fa-check"></i><b>7.7.3</b> Field Goal Success</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Sports Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monte-carlo-simulation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Monte Carlo Simulation<a href="monte-carlo-simulation.html#monte-carlo-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="basics" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Basics<a href="monte-carlo-simulation.html#basics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Monte Carlo Simulation is a collection of computer-driven, computational algorithms that use repeated random sampling to calculate estimates. The basic steps for such a simulation are as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Set seed for replicability</p></li>
<li><p>Initialize all variables/vectors</p></li>
<li><p>Loop through “n” simulations and save simulated values</p></li>
<li><p>Analyze the simulated values from the “n” simulations</p></li>
</ol>
<p>One function that will be particularly useful for simulation is <code>set.seed()</code>.</p>
<p><code>set.seed()</code> allows us to replicate any simulation by giving the initial seed for the simulation. The actual number that is “seeded” is not particularly important though if you want to replicate the same simulations, you will want to re-use this number.</p>
<div style="page-break-after: always;"></div>
<div class="example">
<p><span id="exm:unlabeled-div-121" class="example"><strong>Example 4.1  </strong></span>Simulate 10 overtime coin tosses with and without using <code>set.seed()</code> and compare the results</p>
</div>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="monte-carlo-simulation.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 1</span></span>
<span id="cb171-2"><a href="monte-carlo-simulation.html#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;H&quot;</span>,<span class="st">&quot;T&quot;</span>),<span class="at">size=</span><span class="dv">10</span>,<span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="at">replace=</span>T)</span></code></pre></div>
<pre><code>##  [1] &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; &quot;H&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot;</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="monte-carlo-simulation.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 2</span></span>
<span id="cb173-2"><a href="monte-carlo-simulation.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;H&quot;</span>,<span class="st">&quot;T&quot;</span>),<span class="at">size=</span><span class="dv">10</span>,<span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="at">replace=</span>T)</span></code></pre></div>
<pre><code>##  [1] &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; &quot;H&quot; &quot;H&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot;</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="monte-carlo-simulation.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 3</span></span>
<span id="cb175-2"><a href="monte-carlo-simulation.html#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb175-3"><a href="monte-carlo-simulation.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;H&quot;</span>,<span class="st">&quot;T&quot;</span>),<span class="at">size=</span><span class="dv">10</span>,<span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="at">replace=</span>T)</span></code></pre></div>
<pre><code>##  [1] &quot;H&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot;</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="monte-carlo-simulation.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 4</span></span>
<span id="cb177-2"><a href="monte-carlo-simulation.html#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb177-3"><a href="monte-carlo-simulation.html#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;H&quot;</span>,<span class="st">&quot;T&quot;</span>),<span class="at">size=</span><span class="dv">10</span>,<span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="at">replace=</span>T)</span></code></pre></div>
<pre><code>##  [1] &quot;H&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot;</code></pre>
<p>Simulation can be very helpful when you want to estimate quantities that are not easily solved using analytical methods like formulas.</p>
<div style="page-break-after: always;"></div>
<div class="example">
<p><span id="exm:unlabeled-div-122" class="example"><strong>Example 4.2  </strong></span>Shaquille O’Neal has a career free throw percentage of 52.7%. Suppose that Shaq takes 10 free throw shots. What is the probability that he makes all 10 shots?</p>
</div>
<p>In this case, we can calculate the exact probability of interest using binomial random variable.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="monte-carlo-simulation.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="at">x=</span><span class="dv">10</span>,<span class="at">size=</span><span class="dv">10</span>,<span class="at">prob=</span><span class="fl">0.527</span>)</span></code></pre></div>
<pre><code>## [1] 0.001652366</code></pre>
<p>In more complicated simulations, there may not be an easy formula to use to calculate the value of interest. In these situations, simulation can be very helpful in estimating quantities.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="monte-carlo-simulation.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb181-2"><a href="monte-carlo-simulation.html#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="monte-carlo-simulation.html#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of Simulations</span></span>
<span id="cb181-4"><a href="monte-carlo-simulation.html#cb181-4" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb181-5"><a href="monte-carlo-simulation.html#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="monte-carlo-simulation.html#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize FT variable with 10000 zeros</span></span>
<span id="cb181-7"><a href="monte-carlo-simulation.html#cb181-7" aria-hidden="true" tabindex="-1"></a>FT <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb181-8"><a href="monte-carlo-simulation.html#cb181-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-9"><a href="monte-carlo-simulation.html#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb181-10"><a href="monte-carlo-simulation.html#cb181-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate 10 free throws</span></span>
<span id="cb181-11"><a href="monte-carlo-simulation.html#cb181-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.473</span>,<span class="fl">0.527</span>) )</span>
<span id="cb181-12"><a href="monte-carlo-simulation.html#cb181-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb181-13"><a href="monte-carlo-simulation.html#cb181-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of free throws made and store them in FT</span></span>
<span id="cb181-14"><a href="monte-carlo-simulation.html#cb181-14" aria-hidden="true" tabindex="-1"></a>  FT[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(temp)</span>
<span id="cb181-15"><a href="monte-carlo-simulation.html#cb181-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb181-16"><a href="monte-carlo-simulation.html#cb181-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-17"><a href="monte-carlo-simulation.html#cb181-17" aria-hidden="true" tabindex="-1"></a>FT <span class="sc">%&gt;%</span> </span>
<span id="cb181-18"><a href="monte-carlo-simulation.html#cb181-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb181-19"><a href="monte-carlo-simulation.html#cb181-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>FT)) <span class="sc">+</span> </span>
<span id="cb181-20"><a href="monte-carlo-simulation.html#cb181-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb181-21"><a href="monte-carlo-simulation.html#cb181-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Number of free throws made out of 10&quot;</span>) <span class="sc">+</span> </span>
<span id="cb181-22"><a href="monte-carlo-simulation.html#cb181-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>))</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="monte-carlo-simulation.html#cb182-1" aria-hidden="true" tabindex="-1"></a>prob10 <span class="ot">&lt;-</span> <span class="fu">sum</span>(FT <span class="sc">==</span> <span class="dv">10</span>)<span class="sc">/</span>n.sims; prob10</span></code></pre></div>
<pre><code>## [1] 0.0023</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="monte-carlo-simulation.html#cb184-1" aria-hidden="true" tabindex="-1"></a>prob10 <span class="ot">&lt;-</span> <span class="fu">mean</span>(FT <span class="sc">==</span> <span class="dv">10</span>); prob10</span></code></pre></div>
<pre><code>## [1] 0.0023</code></pre>
<p>The estimated probability that Shaq goes 10-for-10 in free throw attempts based on his career average is 0.0023.</p>
<p>If we run the simulation again with a different seed, we will get another estimate (0.0019).</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="monte-carlo-simulation.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb186-2"><a href="monte-carlo-simulation.html#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="monte-carlo-simulation.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of Simulations</span></span>
<span id="cb186-4"><a href="monte-carlo-simulation.html#cb186-4" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb186-5"><a href="monte-carlo-simulation.html#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="monte-carlo-simulation.html#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize FT variable with 10000 zeros</span></span>
<span id="cb186-7"><a href="monte-carlo-simulation.html#cb186-7" aria-hidden="true" tabindex="-1"></a>FT <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb186-8"><a href="monte-carlo-simulation.html#cb186-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-9"><a href="monte-carlo-simulation.html#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb186-10"><a href="monte-carlo-simulation.html#cb186-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate 10 free throws</span></span>
<span id="cb186-11"><a href="monte-carlo-simulation.html#cb186-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.473</span>,<span class="fl">0.527</span>) )</span>
<span id="cb186-12"><a href="monte-carlo-simulation.html#cb186-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb186-13"><a href="monte-carlo-simulation.html#cb186-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of free throws made and store them in FT</span></span>
<span id="cb186-14"><a href="monte-carlo-simulation.html#cb186-14" aria-hidden="true" tabindex="-1"></a>  FT[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(temp)</span>
<span id="cb186-15"><a href="monte-carlo-simulation.html#cb186-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb186-16"><a href="monte-carlo-simulation.html#cb186-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-17"><a href="monte-carlo-simulation.html#cb186-17" aria-hidden="true" tabindex="-1"></a>prob10 <span class="ot">&lt;-</span> <span class="fu">mean</span>(FT <span class="sc">==</span> <span class="dv">10</span>); prob10</span></code></pre></div>
<pre><code>## [1] 0.0019</code></pre>
<p>As we increase the number of simulations, the estimate will become more accurate.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="monte-carlo-simulation.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb188-2"><a href="monte-carlo-simulation.html#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="monte-carlo-simulation.html#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of Simulations</span></span>
<span id="cb188-4"><a href="monte-carlo-simulation.html#cb188-4" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb188-5"><a href="monte-carlo-simulation.html#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="monte-carlo-simulation.html#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize FT variable with 10000 zeros</span></span>
<span id="cb188-7"><a href="monte-carlo-simulation.html#cb188-7" aria-hidden="true" tabindex="-1"></a>FT <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb188-8"><a href="monte-carlo-simulation.html#cb188-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-9"><a href="monte-carlo-simulation.html#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb188-10"><a href="monte-carlo-simulation.html#cb188-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate 10 free throws</span></span>
<span id="cb188-11"><a href="monte-carlo-simulation.html#cb188-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.473</span>,<span class="fl">0.527</span>) )</span>
<span id="cb188-12"><a href="monte-carlo-simulation.html#cb188-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-13"><a href="monte-carlo-simulation.html#cb188-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of free throws made and store them in FT</span></span>
<span id="cb188-14"><a href="monte-carlo-simulation.html#cb188-14" aria-hidden="true" tabindex="-1"></a>  FT[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(temp)</span>
<span id="cb188-15"><a href="monte-carlo-simulation.html#cb188-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb188-16"><a href="monte-carlo-simulation.html#cb188-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-17"><a href="monte-carlo-simulation.html#cb188-17" aria-hidden="true" tabindex="-1"></a>prob10 <span class="ot">&lt;-</span> <span class="fu">mean</span>(FT<span class="sc">==</span><span class="dv">10</span>); prob10</span></code></pre></div>
<pre><code>## [1] 0.00174</code></pre>
<p>One way to simulate data is to make assumptions about the distributions of the underlying data. The random variables given in the last chapter as possible candidates.</p>
</div>
<div id="estimating-probabilities" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Estimating Probabilities<a href="monte-carlo-simulation.html#estimating-probabilities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can use simulation to estimate probabilities of different events occurring. One way to do this is for each simulation to record a “1” if the event of interest occurs and a “0” if the event of interest does not occur.</p>
<div class="definition">
<p><span id="def:unlabeled-div-123" class="definition"><strong>Definition 4.1  </strong></span>The <strong><em>indicator function</em></strong>, <span class="math inline">\(I(A)\)</span>, is defined such that <span class="math inline">\(I(A)\)</span> is equal to 1 if <span class="math inline">\(A\)</span> occurs and is equal to 0 if <span class="math inline">\(A\)</span> does not occur.</p>
</div>
<p>For instance, suppose we roll a die and a “6” is on top. Then we have the following: <span class="math inline">\(I(6)=1, I(5)=0, I(even)=1, I(odd)=0\)</span>.</p>
<p>One way to calculate probabilities is to use the following rule: <span class="math inline">\(P(A) = E[I(A)]\)</span>. The probability that <span class="math inline">\(A\)</span> occurs is equal to the expected value of the indicator function of <span class="math inline">\(A\)</span>.</p>
<div class="example">
<p><span id="exm:unlabeled-div-124" class="example"><strong>Example 4.3  </strong></span>During the 2021 WNBA season, Kahleah Copper of the Chicago Sky had a free throw percentage of 81.8%. She played a total of 32 games and the probability mass function for number of free throw attempts per game are given in the table below. Estimate the probability that Copper did not make a free throw in a game. [Note: Copper did not make a free throw in 6 out of the 32 games for a probability of 0.1875.]</p>
</div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Free Throw Attempt, FTA
</th>
<th style="text-align:center;">
Frequency, nFTA
</th>
<th style="text-align:center;">
Probability, p(FTA)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0.156
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.062
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
0.250
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.000
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
0.219
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.062
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.125
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.062
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.062
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="monte-carlo-simulation.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020</span>)</span>
<span id="cb190-2"><a href="monte-carlo-simulation.html#cb190-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb190-3"><a href="monte-carlo-simulation.html#cb190-3" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> <span class="dv">32</span></span>
<span id="cb190-4"><a href="monte-carlo-simulation.html#cb190-4" aria-hidden="true" tabindex="-1"></a>FTprob <span class="ot">&lt;-</span> <span class="fl">0.818</span></span>
<span id="cb190-5"><a href="monte-carlo-simulation.html#cb190-5" aria-hidden="true" tabindex="-1"></a>FTA <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="cb190-6"><a href="monte-carlo-simulation.html#cb190-6" aria-hidden="true" tabindex="-1"></a>nFTA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb190-7"><a href="monte-carlo-simulation.html#cb190-7" aria-hidden="true" tabindex="-1"></a>pFTA <span class="ot">&lt;-</span> nFTA<span class="sc">/</span><span class="dv">32</span></span>
<span id="cb190-8"><a href="monte-carlo-simulation.html#cb190-8" aria-hidden="true" tabindex="-1"></a>FT <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n.sims)</span>
<span id="cb190-9"><a href="monte-carlo-simulation.html#cb190-9" aria-hidden="true" tabindex="-1"></a>FT0.ind <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb190-10"><a href="monte-carlo-simulation.html#cb190-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-11"><a href="monte-carlo-simulation.html#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate the number of FTA per game</span></span>
<span id="cb190-12"><a href="monte-carlo-simulation.html#cb190-12" aria-hidden="true" tabindex="-1"></a>FTA.sim <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> FTA,<span class="at">size =</span> n.sims,<span class="at">replace =</span> T,<span class="at">prob =</span> pFTA)</span>
<span id="cb190-13"><a href="monte-carlo-simulation.html#cb190-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-14"><a href="monte-carlo-simulation.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 10,000 games and record number of FT made</span></span>
<span id="cb190-15"><a href="monte-carlo-simulation.html#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb190-16"><a href="monte-carlo-simulation.html#cb190-16" aria-hidden="true" tabindex="-1"></a>  FT[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="at">size =</span> FTA.sim[i],<span class="at">prob =</span> FTprob)</span>
<span id="cb190-17"><a href="monte-carlo-simulation.html#cb190-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb190-18"><a href="monte-carlo-simulation.html#cb190-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-19"><a href="monte-carlo-simulation.html#cb190-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the header of the simulated data</span></span>
<span id="cb190-20"><a href="monte-carlo-simulation.html#cb190-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(FT)</span></code></pre></div>
<pre><code>## [1] 6 3 0 0 1 1</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="monte-carlo-simulation.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create indicator function for 0 FT made</span></span>
<span id="cb192-2"><a href="monte-carlo-simulation.html#cb192-2" aria-hidden="true" tabindex="-1"></a>FT0.ind <span class="ot">=</span> FT <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb192-3"><a href="monte-carlo-simulation.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(FT0.ind)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="monte-carlo-simulation.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability via mean of the indicator function</span></span>
<span id="cb194-2"><a href="monte-carlo-simulation.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(FT0.ind)</span></code></pre></div>
<pre><code>## [1] 0.1711</code></pre>
<div style="page-break-after: always;"></div>
<div class="example">
<p><span id="exm:unlabeled-div-125" class="example"><strong>Example 4.4  </strong></span>The number of regulation goals scored in a game by Hockey Team A, <span class="math inline">\(X\)</span>, is a Poisson(4) random variable, and the same for Hockey Team B, <span class="math inline">\(Y\)</span>, is a Poisson(3.2) random variable.</p>
<p>A statistician is interested in the probability that Team A defeats Team B in regulation. This is <span class="math inline">\(P(X&gt;Y)\)</span> which is difficult to calculate manually. However, using simulation, we can straightforwardly obtain an accurate estimation of this quantity.</p>
</div>
<p>There are many built-in functions in <code>R</code> that allow users to generate realizations from common probability distributions (<code>rnorm</code>, <code>rbinom</code>, <code>rexp</code>, etc.) Let’s use the <code>rpois</code> function to simulate the appropriate variables, remembering to set a seed so that our results are easily replicable.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="monte-carlo-simulation.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb196-2"><a href="monte-carlo-simulation.html#cb196-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb196-3"><a href="monte-carlo-simulation.html#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="monte-carlo-simulation.html#cb196-4" aria-hidden="true" tabindex="-1"></a>team_A_goals <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> n.sims, <span class="at">lambda =</span> <span class="dv">4</span>)</span>
<span id="cb196-5"><a href="monte-carlo-simulation.html#cb196-5" aria-hidden="true" tabindex="-1"></a>team_B_goals <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> n.sims, <span class="at">lambda =</span> <span class="fl">3.2</span>)</span></code></pre></div>
<p>Now, to find <span class="math inline">\(P(X &gt; Y)\)</span>, we can use the following line of code:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="monte-carlo-simulation.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(team_A_goals <span class="sc">&gt;</span> team_B_goals)</span></code></pre></div>
<pre><code>## [1] 0.5415</code></pre>
<p>Why does this work? First, operations to vectors are executed elementwise, meaning that <code>R</code> compares <code>team_A_goals[1]</code> to <code>team_B_goals[1]</code>, then <code>team_A_goals[2]</code> to <code>team_B_goals[2]</code>, and so on. Second, logical operators are stored as zeroes (when the condition is false) and ones (when the condition is true). The mean of a vector of zeroes and ones is the proportion of ones, which is the frequency of the logical statement being true. In our simulation, it was 0.5415. The true value is 0.5427, meaning that the simulation was quite accurate.</p>
<div style="page-break-after: always;"></div>
<div class="example">
<p><span id="exm:unlabeled-div-126" class="example"><strong>Example 4.5  </strong></span>In baseball, hitting for the cycle requires a hitter to get a single, double, triple, and home run in the same game. This is a rare occurrence in professional baseball having happened only 339 times at present count.</p>
<p>On August 10, 2009, Colorado Rockie Troy Tulowitzki hit for the cycle against the Cubs at Coors Field in Denver going 5-for-5 with two singles, one double, one triple, and one home run. Here’s a video recap: <a href="https://www.youtube.com/watch?v=sTU6ice3ga0" class="uri">https://www.youtube.com/watch?v=sTU6ice3ga0</a></p>
<p>Simulate 100,000 games (5 at-bats per game) for Tulowitzki based on his career numbers and use them to estimate the probability that Tulowitzki hits for the cycle.</p>
<p>Tulowitzki’s career totals are: 4804 at-bats, 878 singles, 264 doubles, 24 triples, and 225 home runs.</p>
</div>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="monte-carlo-simulation.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb199-2"><a href="monte-carlo-simulation.html#cb199-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb199-3"><a href="monte-carlo-simulation.html#cb199-3" aria-hidden="true" tabindex="-1"></a>n.ab <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb199-4"><a href="monte-carlo-simulation.html#cb199-4" aria-hidden="true" tabindex="-1"></a>cycle.ind <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb199-5"><a href="monte-carlo-simulation.html#cb199-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-6"><a href="monte-carlo-simulation.html#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Possible outcomes: 0 = out/walk, 1 = single, 2 = double, 3 = triple, 4 = HR</span></span>
<span id="cb199-7"><a href="monte-carlo-simulation.html#cb199-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb199-8"><a href="monte-carlo-simulation.html#cb199-8" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3413</span>,<span class="dv">878</span>,<span class="dv">264</span>,<span class="dv">24</span>,<span class="dv">225</span>)<span class="sc">/</span><span class="dv">4804</span></span>
<span id="cb199-9"><a href="monte-carlo-simulation.html#cb199-9" aria-hidden="true" tabindex="-1"></a>tulo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x,px)</span>
<span id="cb199-10"><a href="monte-carlo-simulation.html#cb199-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-11"><a href="monte-carlo-simulation.html#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb199-12"><a href="monte-carlo-simulation.html#cb199-12" aria-hidden="true" tabindex="-1"></a>  game <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> tulo<span class="sc">$</span>x, <span class="at">prob =</span> tulo<span class="sc">$</span>px, <span class="at">size =</span> n.ab, <span class="at">replace =</span> T)</span>
<span id="cb199-13"><a href="monte-carlo-simulation.html#cb199-13" aria-hidden="true" tabindex="-1"></a>  cycle <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">%in%</span> game) <span class="sc">&amp;</span> (<span class="dv">2</span> <span class="sc">%in%</span> game) <span class="sc">&amp;</span> (<span class="dv">3</span> <span class="sc">%in%</span> game) <span class="sc">&amp;</span> (<span class="dv">4</span> <span class="sc">%in%</span> game)</span>
<span id="cb199-14"><a href="monte-carlo-simulation.html#cb199-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( cycle ){</span>
<span id="cb199-15"><a href="monte-carlo-simulation.html#cb199-15" aria-hidden="true" tabindex="-1"></a>    cycle.ind[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb199-16"><a href="monte-carlo-simulation.html#cb199-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-17"><a href="monte-carlo-simulation.html#cb199-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb199-18"><a href="monte-carlo-simulation.html#cb199-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-19"><a href="monte-carlo-simulation.html#cb199-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cycle.ind)</span></code></pre></div>
<pre><code>## [1] 0.00024</code></pre>
<div style="page-break-after: always;"></div>
</div>
<div id="simulating-streaks" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Simulating Streaks<a href="monte-carlo-simulation.html#simulating-streaks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Streaks are often of interest to casual sports fans. Some especially famous streaks include Joe DiMaggio’s 56-game hitting streak in 1941, Wayne Gretzky’s 51 consecutive games with a point in 1983-1984, and the Chicago Cubs 108 year World Series drought.</p>
<p>Simulation can be helpful in quantifying the likelihood of different kinds of streaks like winning streaks or hitting streaks.</p>
<div id="winning-streak-simulation" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Winning Streak Simulation<a href="monte-carlo-simulation.html#winning-streak-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="example">
<p><span id="exm:unlabeled-div-127" class="example"><strong>Example 4.6  </strong></span>Suppose an NBA team is in the middle of a rebuild and has a 25% probability of winning each of its games in the following 82-game season. What is the probability that the team will go on at least one winning streak of four or more games over the course of the 82-game season? Use simulation to answer this question.</p>
</div>
<p>We can simulate a season for the team, find the longest winning streak in that season, and store it in a vector. After repeating that process 10,000 times, we can then find the proportion of the values in that vector that are greater than or equal to 4.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="monte-carlo-simulation.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb201-2"><a href="monte-carlo-simulation.html#cb201-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb201-3"><a href="monte-carlo-simulation.html#cb201-3" aria-hidden="true" tabindex="-1"></a>n.games <span class="ot">&lt;-</span> <span class="dv">82</span></span>
<span id="cb201-4"><a href="monte-carlo-simulation.html#cb201-4" aria-hidden="true" tabindex="-1"></a>win.prob <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb201-5"><a href="monte-carlo-simulation.html#cb201-5" aria-hidden="true" tabindex="-1"></a>longest_streak <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n.sims)</span>
<span id="cb201-6"><a href="monte-carlo-simulation.html#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="monte-carlo-simulation.html#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims) {</span>
<span id="cb201-8"><a href="monte-carlo-simulation.html#cb201-8" aria-hidden="true" tabindex="-1"></a>  game_results <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">n =</span> n.games, <span class="at">prob =</span> win.prob) <span class="co"># 1=win, 0=loss</span></span>
<span id="cb201-9"><a href="monte-carlo-simulation.html#cb201-9" aria-hidden="true" tabindex="-1"></a>  streaks <span class="ot">&lt;-</span> <span class="fu">rle</span>(game_results)</span>
<span id="cb201-10"><a href="monte-carlo-simulation.html#cb201-10" aria-hidden="true" tabindex="-1"></a>  longest_streak[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(streaks<span class="sc">$</span>lengths[streaks<span class="sc">$</span>values<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb201-11"><a href="monte-carlo-simulation.html#cb201-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb201-12"><a href="monte-carlo-simulation.html#cb201-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-13"><a href="monte-carlo-simulation.html#cb201-13" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(longest_streak)</span></code></pre></div>
<pre><code>## longest_streak
##    1    2    3    4    5    6    7    8    9 
##  116 3626 4233 1480  410  105   21    7    2</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="monte-carlo-simulation.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(longest_streak <span class="sc">&gt;=</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 0.2025</code></pre>
<!-- https://stackoverflow.com/questions/28731582/maximum-consecutive-repeats-in-a-vector-in-r -->
<p>The team had a 4+ game winning streak in about 20% of the simulations.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="hitting-streak-simulation" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Hitting Streak Simulation<a href="monte-carlo-simulation.html#hitting-streak-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In 1941, New York Yankee Joe DiMaggio had a 56-game hitting streak which is an all-time record in MLB. How unlikely was such an outcome?</p>
<p>Background videos on DiMaggio’s 56 game hitting streak:</p>
<p><a href="https://www.youtube.com/watch?v=Y5K49dtOKmo" class="uri">https://www.youtube.com/watch?v=Y5K49dtOKmo</a></p>
<p><a href="https://www.youtube.com/embed/BErlc16YS8A" class="uri">https://www.youtube.com/embed/BErlc16YS8A</a></p>
<div class="example">
<p><span id="exm:unlabeled-div-128" class="example"><strong>Example 4.7  </strong></span>Let’s build a simulation to estimate the probability of a hitting streak of at least 56 games using DiMaggio’s statistics. DiMaggio’s 1941 game log is contained in <code>dimaggio41.csv</code>.</p>
</div>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="monte-carlo-simulation.html#cb205-1" aria-hidden="true" tabindex="-1"></a>dimaggio <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/dimaggio41.csv&quot;</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb205-2"><a href="monte-carlo-simulation.html#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="monte-carlo-simulation.html#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dimaggio)</span></code></pre></div>
<pre><code>##  [1] &quot;Rk&quot;   &quot;Gtm&quot;  &quot;Date&quot; &quot;Opp&quot;  &quot;Rslt&quot; &quot;PA&quot;   &quot;AB&quot;   &quot;R&quot;    &quot;H&quot;    &quot;2B&quot;  
## [11] &quot;3B&quot;   &quot;HR&quot;   &quot;RBI&quot;  &quot;BB&quot;   &quot;IBB&quot;  &quot;SO&quot;   &quot;HBP&quot;  &quot;SH&quot;   &quot;SF&quot;   &quot;ROE&quot; 
## [21] &quot;GDP&quot;  &quot;SB&quot;   &quot;CS&quot;   &quot;BA&quot;   &quot;OBP&quot;  &quot;SLG&quot;  &quot;OPS&quot;  &quot;BOP&quot;  &quot;aLI&quot;  &quot;WPA&quot; 
## [31] &quot;acLI&quot; &quot;cWPA&quot; &quot;RE24&quot; &quot;Pos&quot;</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="monte-carlo-simulation.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(dimaggio)</span></code></pre></div>
<pre><code>## [1] 140</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="monte-carlo-simulation.html#cb209-1" aria-hidden="true" tabindex="-1"></a>dimaggio <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">139</span><span class="sc">:</span><span class="dv">140</span>) <span class="sc">%&gt;%</span> <span class="fu">kt</span>()</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Rk
</th>
<th style="text-align:center;">
Gtm
</th>
<th style="text-align:center;">
Date
</th>
<th style="text-align:center;">
Opp
</th>
<th style="text-align:center;">
Rslt
</th>
<th style="text-align:center;">
PA
</th>
<th style="text-align:center;">
AB
</th>
<th style="text-align:center;">
R
</th>
<th style="text-align:center;">
H
</th>
<th style="text-align:center;">
2B
</th>
<th style="text-align:center;">
3B
</th>
<th style="text-align:center;">
HR
</th>
<th style="text-align:center;">
RBI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Apr 14
</td>
<td style="text-align:center;">
WSH
</td>
<td style="text-align:center;">
W3-0
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Apr 15
</td>
<td style="text-align:center;">
PHA
</td>
<td style="text-align:center;">
L1-3
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
Apr 16
</td>
<td style="text-align:center;">
PHA
</td>
<td style="text-align:center;">
L7-10
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
Apr 17
</td>
<td style="text-align:center;">
PHA
</td>
<td style="text-align:center;">
W9-4
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
Apr 18
</td>
<td style="text-align:center;">
WSH
</td>
<td style="text-align:center;">
L4-7
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
Apr 19
</td>
<td style="text-align:center;">
WSH
</td>
<td style="text-align:center;">
W5-2
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
Apr 20
</td>
<td style="text-align:center;">
PHA
</td>
<td style="text-align:center;">
W19-5
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
Apr 21
</td>
<td style="text-align:center;">
PHA
</td>
<td style="text-align:center;">
W14-4
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
Apr 22
</td>
<td style="text-align:center;">
PHA
</td>
<td style="text-align:center;">
L5-6
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
Apr 23
</td>
<td style="text-align:center;">
BOS
</td>
<td style="text-align:center;">
W4-2
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
139
</td>
<td style="text-align:center;">
156
</td>
<td style="text-align:center;">
Sep 28
</td>
<td style="text-align:center;">
WSH
</td>
<td style="text-align:center;">
L0-5
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
90-47
</td>
<td style="text-align:center;">
622
</td>
<td style="text-align:center;">
541
</td>
<td style="text-align:center;">
122
</td>
<td style="text-align:center;">
193
</td>
<td style="text-align:center;">
43
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
30
</td>
<td style="text-align:center;">
125
</td>
</tr>
</tbody>
</table>
<p>DiMaggio played in 139 games, had 622 plate appearances, 541 at-bats, and 193 hits.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="monte-carlo-simulation.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove last row (totals)</span></span>
<span id="cb210-2"><a href="monte-carlo-simulation.html#cb210-2" aria-hidden="true" tabindex="-1"></a>dimaggio <span class="ot">&lt;-</span> dimaggio <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">139</span>)</span>
<span id="cb210-3"><a href="monte-carlo-simulation.html#cb210-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4"><a href="monte-carlo-simulation.html#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create indicator variable for a hit</span></span>
<span id="cb210-5"><a href="monte-carlo-simulation.html#cb210-5" aria-hidden="true" tabindex="-1"></a>hit.game <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dimaggio<span class="sc">$</span>H <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb210-6"><a href="monte-carlo-simulation.html#cb210-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-7"><a href="monte-carlo-simulation.html#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use rle to calculate the streak lengths</span></span>
<span id="cb210-8"><a href="monte-carlo-simulation.html#cb210-8" aria-hidden="true" tabindex="-1"></a>streaks <span class="ot">&lt;-</span> <span class="fu">rle</span>(hit.game)</span>
<span id="cb210-9"><a href="monte-carlo-simulation.html#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(streaks)</span></code></pre></div>
<pre><code>##        values
## lengths 0 1
##      1  5 2
##      2  4 3
##      3  4 2
##      4  0 2
##      5  0 1
##      7  0 1
##      8  0 1
##      16 0 1
##      56 0 1</code></pre>
<p>As seen above, DiMaggio had a 56-game hitting streak. An impossible feat to match?</p>
<ol style="list-style-type: lower-alpha">
<li>Create a histograms for DiMaggio’s per game plate appearances and at bats. (Hint: for discrete values, <code>geom_bar()</code> is often a good option.)</li>
</ol>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="monte-carlo-simulation.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb212-2"><a href="monte-carlo-simulation.html#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="monte-carlo-simulation.html#cb212-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> dimaggio <span class="sc">%&gt;%</span> </span>
<span id="cb212-4"><a href="monte-carlo-simulation.html#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>PA)) <span class="sc">+</span> </span>
<span id="cb212-5"><a href="monte-carlo-simulation.html#cb212-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb212-6"><a href="monte-carlo-simulation.html#cb212-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb212-7"><a href="monte-carlo-simulation.html#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;DiMaggio Plate Appearances Per Game, 1941&quot;</span>) <span class="sc">+</span></span>
<span id="cb212-8"><a href="monte-carlo-simulation.html#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Plate Appearances&quot;</span>)</span>
<span id="cb212-9"><a href="monte-carlo-simulation.html#cb212-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> dimaggio <span class="sc">%&gt;%</span> </span>
<span id="cb212-10"><a href="monte-carlo-simulation.html#cb212-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>AB)) <span class="sc">+</span> </span>
<span id="cb212-11"><a href="monte-carlo-simulation.html#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb212-12"><a href="monte-carlo-simulation.html#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb212-13"><a href="monte-carlo-simulation.html#cb212-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;DiMaggio At-Bats Per Game, 1941&quot;</span>) <span class="sc">+</span></span>
<span id="cb212-14"><a href="monte-carlo-simulation.html#cb212-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;At-Bats&quot;</span>)</span>
<span id="cb212-15"><a href="monte-carlo-simulation.html#cb212-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-16"><a href="monte-carlo-simulation.html#cb212-16" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Create a frequency and percentage frequency table for plate appearances and at-bats.</li>
</ol>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="monte-carlo-simulation.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb213-2"><a href="monte-carlo-simulation.html#cb213-2" aria-hidden="true" tabindex="-1"></a>table.pa <span class="ot">=</span> <span class="fu">tabyl</span>(dimaggio,PA) <span class="sc">%&gt;%</span> </span>
<span id="cb213-3"><a href="monte-carlo-simulation.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-4"><a href="monte-carlo-simulation.html#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb213-5"><a href="monte-carlo-simulation.html#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table.pa) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Plate Appearances&quot;</span>, <span class="st">&quot;Frequency&quot;</span>, <span class="st">&quot;Percent&quot;</span>)</span>
<span id="cb213-6"><a href="monte-carlo-simulation.html#cb213-6" aria-hidden="true" tabindex="-1"></a>table.pa <span class="sc">%&gt;%</span> <span class="fu">kt</span>()</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Plate Appearances
</th>
<th style="text-align:center;">
Frequency
</th>
<th style="text-align:center;">
Percent
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1.4%
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2.9%
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
70
</td>
<td style="text-align:center;">
50.4%
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
56
</td>
<td style="text-align:center;">
40.3%
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
3.6%
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.7%
</td>
</tr>
<tr>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.7%
</td>
</tr>
<tr>
<td style="text-align:center;">
Total
</td>
<td style="text-align:center;">
139
</td>
<td style="text-align:center;">
100.0%
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="monte-carlo-simulation.html#cb214-1" aria-hidden="true" tabindex="-1"></a>table.ab <span class="ot">=</span> <span class="fu">tabyl</span>(dimaggio,AB) <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="monte-carlo-simulation.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb214-3"><a href="monte-carlo-simulation.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb214-4"><a href="monte-carlo-simulation.html#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table.ab) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;At-Bats&quot;</span>, <span class="st">&quot;Frequency&quot;</span>, <span class="st">&quot;Percent&quot;</span>)</span>
<span id="cb214-5"><a href="monte-carlo-simulation.html#cb214-5" aria-hidden="true" tabindex="-1"></a>table.ab <span class="sc">%&gt;%</span> <span class="fu">kt</span>()</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
At-Bats
</th>
<th style="text-align:center;">
Frequency
</th>
<th style="text-align:center;">
Percent
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
5.0%
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
37
</td>
<td style="text-align:center;">
26.6%
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
63
</td>
<td style="text-align:center;">
45.3%
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
30
</td>
<td style="text-align:center;">
21.6%
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.7%
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.7%
</td>
</tr>
<tr>
<td style="text-align:center;">
Total
</td>
<td style="text-align:center;">
139
</td>
<td style="text-align:center;">
100.0%
</td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: lower-alpha">
<li>DiMaggio had 193 hits in 622 plate appearances over 139 games. We will simulate DiMaggio’s season of 139 games 100,000 times to estimate the probability of a 56-game hitting streak.</li>
</ol>
<p>There are many ways to do this. Let’s use the <em>empirical probability mass function</em> of his per game plate appearances to simulate the number of plate appearances that he gets in his 139 games.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="monte-carlo-simulation.html#cb215-1" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span> <span class="fu">tabyl</span>(dimaggio,PA) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb215-2"><a href="monte-carlo-simulation.html#cb215-2" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span> pa <span class="sc">%&gt;%</span> </span>
<span id="cb215-3"><a href="monte-carlo-simulation.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb215-4"><a href="monte-carlo-simulation.html#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Prob=</span>n<span class="sc">/</span><span class="dv">139</span>)</span>
<span id="cb215-5"><a href="monte-carlo-simulation.html#cb215-5" aria-hidden="true" tabindex="-1"></a>pa <span class="sc">%&gt;%</span> <span class="fu">kt</span>()</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
PA
</th>
<th style="text-align:center;">
n
</th>
<th style="text-align:center;">
Prob
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0.014
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
0.029
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
70
</td>
<td style="text-align:center;">
0.504
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
56
</td>
<td style="text-align:center;">
0.403
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0.036
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.007
</td>
</tr>
<tr>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.007
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="monte-carlo-simulation.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One simulated season of per game plate appearances</span></span>
<span id="cb216-2"><a href="monte-carlo-simulation.html#cb216-2" aria-hidden="true" tabindex="-1"></a>sim.pa <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span>pa<span class="sc">$</span>PA,<span class="at">prob =</span> pa<span class="sc">$</span>Prob,<span class="at">size=</span><span class="dv">139</span>,<span class="at">replace=</span>T)</span>
<span id="cb216-3"><a href="monte-carlo-simulation.html#cb216-3" aria-hidden="true" tabindex="-1"></a>sim.pa</span></code></pre></div>
<pre><code>##   [1] 4 4 4 9 4 4 4 5 2 5 5 5 4 5 4 4 4 4 4 4 5 5 4 5 9 7 4 4 5 5 5 5 5 5 6 4 5
##  [38] 4 5 4 5 5 4 4 5 4 5 7 2 5 4 5 4 4 4 4 4 5 4 4 4 5 6 4 4 5 4 4 5 4 5 6 4 5
##  [75] 4 4 4 4 5 4 5 4 5 4 5 3 5 5 3 5 4 2 4 5 4 4 4 4 5 5 4 5 5 4 5 5 4 5 5 5 4
## [112] 5 4 4 4 5 4 5 4 4 4 4 5 5 4 4 5 5 4 5 4 4 4 4 5 4 4 5 4</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="monte-carlo-simulation.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DiMaggio Simulation</span></span>
<span id="cb218-2"><a href="monte-carlo-simulation.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb218-3"><a href="monte-carlo-simulation.html#cb218-3" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb218-4"><a href="monte-carlo-simulation.html#cb218-4" aria-hidden="true" tabindex="-1"></a>n.games <span class="ot">&lt;-</span> <span class="dv">139</span></span>
<span id="cb218-5"><a href="monte-carlo-simulation.html#cb218-5" aria-hidden="true" tabindex="-1"></a>prob.hit <span class="ot">&lt;-</span> <span class="fl">0.310</span></span>
<span id="cb218-6"><a href="monte-carlo-simulation.html#cb218-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-7"><a href="monte-carlo-simulation.html#cb218-7" aria-hidden="true" tabindex="-1"></a>longest.streak <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n.sims)</span>
<span id="cb218-8"><a href="monte-carlo-simulation.html#cb218-8" aria-hidden="true" tabindex="-1"></a>sim.games <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.games)</span>
<span id="cb218-9"><a href="monte-carlo-simulation.html#cb218-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-10"><a href="monte-carlo-simulation.html#cb218-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> n.sims){</span>
<span id="cb218-11"><a href="monte-carlo-simulation.html#cb218-11" aria-hidden="true" tabindex="-1"></a>  sim.pa <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span>pa<span class="sc">$</span>PA,<span class="at">prob =</span> pa<span class="sc">$</span>Prob,<span class="at">size=</span>n.games,<span class="at">replace=</span>T)</span>
<span id="cb218-12"><a href="monte-carlo-simulation.html#cb218-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.games){</span>
<span id="cb218-13"><a href="monte-carlo-simulation.html#cb218-13" aria-hidden="true" tabindex="-1"></a>    sim.games[j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">1</span>,<span class="at">size =</span> sim.pa[j],<span class="at">prob =</span> prob.hit)</span>
<span id="cb218-14"><a href="monte-carlo-simulation.html#cb218-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb218-15"><a href="monte-carlo-simulation.html#cb218-15" aria-hidden="true" tabindex="-1"></a>  sim.hits <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sim.games <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb218-16"><a href="monte-carlo-simulation.html#cb218-16" aria-hidden="true" tabindex="-1"></a>  streaks <span class="ot">&lt;-</span> <span class="fu">rle</span>(sim.hits)</span>
<span id="cb218-17"><a href="monte-carlo-simulation.html#cb218-17" aria-hidden="true" tabindex="-1"></a>  longest.streak[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(streaks<span class="sc">$</span>lengths[streaks<span class="sc">$</span>values<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb218-18"><a href="monte-carlo-simulation.html#cb218-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb218-19"><a href="monte-carlo-simulation.html#cb218-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-20"><a href="monte-carlo-simulation.html#cb218-20" aria-hidden="true" tabindex="-1"></a><span class="co"># table of longest streaks during simulated seasons</span></span>
<span id="cb218-21"><a href="monte-carlo-simulation.html#cb218-21" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(longest.streak)</span></code></pre></div>
<pre><code>## longest.streak
##   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25 
##   3  11  38 127 306 510 756 811 908 920 807 790 685 595 474 421 333 272 258 186 
##  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45 
## 142 139 100  81  68  45  51  28  22  16  13  23  14  11   7   1   5   3   4   5 
##  46  47  48  49  50  56  58  59 
##   2   2   2   1   1   1   1   1</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="monte-carlo-simulation.html#cb220-1" aria-hidden="true" tabindex="-1"></a>longest.streak <span class="sc">%&gt;%</span> </span>
<span id="cb220-2"><a href="monte-carlo-simulation.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="monte-carlo-simulation.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>longest.streak)) <span class="sc">+</span> </span>
<span id="cb220-4"><a href="monte-carlo-simulation.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb220-5"><a href="monte-carlo-simulation.html#cb220-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Longest Hitting Streak for 10,000 Simulated DiMaggio 1941 Seasons&quot;</span>) <span class="sc">+</span></span>
<span id="cb220-6"><a href="monte-carlo-simulation.html#cb220-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Max Hitting Streak in a Simulation Season&quot;</span>)</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="monte-carlo-simulation.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics for 10,000 simulations</span></span>
<span id="cb221-2"><a href="monte-carlo-simulation.html#cb221-2" aria-hidden="true" tabindex="-1"></a>mean.streak <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak); mean.streak</span></code></pre></div>
<pre><code>## [1] 17.2849</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="monte-carlo-simulation.html#cb223-1" aria-hidden="true" tabindex="-1"></a>prob56 <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak<span class="sc">&gt;=</span><span class="dv">56</span>); prob56</span></code></pre></div>
<pre><code>## [1] 3e-04</code></pre>
<p>Running the simulation above with <code>set.seed(2022)</code> and <code>n.sims=10000</code>, we get <span class="math inline">\(P(Streak \geq 66) = 3 \cdot 10^{-4}\)</span>. There were three simulated hitting streaks of at least 56 games.</p>
<p>If we run the simulation again with <code>set.seed(2022)</code> but increase <code>n.sims=100000</code>, we get <span class="math inline">\(P(Streak \geq 66) = \frac{10}{100000} = 10^{-4}\)</span>. In other words, we estimate the probability that DiMaggio gets a hitting streak of at least 56 games in 100000 simulated seasons is about 1-in-10000.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="monte-carlo-simulation.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics for 100,000 simulations</span></span>
<span id="cb225-2"><a href="monte-carlo-simulation.html#cb225-2" aria-hidden="true" tabindex="-1"></a>mean.streak <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak); mean.streak</span></code></pre></div>
<pre><code>## [1] 17.1655</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="monte-carlo-simulation.html#cb227-1" aria-hidden="true" tabindex="-1"></a>prob56 <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak<span class="sc">&gt;=</span><span class="dv">56</span>); prob56</span></code></pre></div>
<pre><code>## [1] 1e-04</code></pre>
<p>We would prefer to not use nested for loops, as they are slow. Can you find a faster simulation method?</p>
<p>Let’s try simulating by permuting DiMaggio’s games. In other words, let’s randomly order DiMaggio’s 1941 games and analyze the hitting streaks.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="monte-carlo-simulation.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create indicator variable for a hit</span></span>
<span id="cb229-2"><a href="monte-carlo-simulation.html#cb229-2" aria-hidden="true" tabindex="-1"></a>hit.game <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dimaggio<span class="sc">$</span>H <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb229-3"><a href="monte-carlo-simulation.html#cb229-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-4"><a href="monte-carlo-simulation.html#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb229-5"><a href="monte-carlo-simulation.html#cb229-5" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb229-6"><a href="monte-carlo-simulation.html#cb229-6" aria-hidden="true" tabindex="-1"></a>longest.streak <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n.sims)</span>
<span id="cb229-7"><a href="monte-carlo-simulation.html#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="monte-carlo-simulation.html#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> n.sims){</span>
<span id="cb229-9"><a href="monte-carlo-simulation.html#cb229-9" aria-hidden="true" tabindex="-1"></a>  sim.hits <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span>hit.game,<span class="at">replace=</span>F)</span>
<span id="cb229-10"><a href="monte-carlo-simulation.html#cb229-10" aria-hidden="true" tabindex="-1"></a>  streaks <span class="ot">&lt;-</span> <span class="fu">rle</span>(sim.hits)</span>
<span id="cb229-11"><a href="monte-carlo-simulation.html#cb229-11" aria-hidden="true" tabindex="-1"></a>  longest.streak[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(streaks<span class="sc">$</span>lengths[streaks<span class="sc">$</span>values<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb229-12"><a href="monte-carlo-simulation.html#cb229-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb229-13"><a href="monte-carlo-simulation.html#cb229-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-14"><a href="monte-carlo-simulation.html#cb229-14" aria-hidden="true" tabindex="-1"></a>longest.streak <span class="sc">%&gt;%</span> </span>
<span id="cb229-15"><a href="monte-carlo-simulation.html#cb229-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb229-16"><a href="monte-carlo-simulation.html#cb229-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>longest.streak)) <span class="sc">+</span> </span>
<span id="cb229-17"><a href="monte-carlo-simulation.html#cb229-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb229-18"><a href="monte-carlo-simulation.html#cb229-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Longest Hitting Streak for 100,000 Simulated DiMaggio 1941 Seasons&quot;</span>) <span class="sc">+</span></span>
<span id="cb229-19"><a href="monte-carlo-simulation.html#cb229-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Max Hitting Streak in a Simulation Season&quot;</span>)</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="monte-carlo-simulation.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics for 100,000 simulations</span></span>
<span id="cb230-2"><a href="monte-carlo-simulation.html#cb230-2" aria-hidden="true" tabindex="-1"></a>mean.streak <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak); mean.streak</span></code></pre></div>
<pre><code>## [1] 18.25769</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="monte-carlo-simulation.html#cb232-1" aria-hidden="true" tabindex="-1"></a>prob56 <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak<span class="sc">&gt;=</span><span class="dv">56</span>); prob56</span></code></pre></div>
<pre><code>## [1] 7e-05</code></pre>
<p>Using this simulation method with reordering, there is an estimated probability of <span class="math inline">\(7 \cdot 10^{-5}\)</span> or about 1-in-14000 chance of DiMaggio hitting a 56-game hit streak.</p>
<p>Other authors have used different simulation and mathematical methods for estimating the rarity of Dimaggio’s 56 game hitting streak.</p>
<p>Billie et al (2010) used an at-bat rather than plate appearance simulation and estimated the likelihood as 1-in-5000.</p>
<p>Rothman et al (2010) estimated the likelihood as 1-in-10000.</p>
<div style="page-break-after: always;"></div>
<div class="example">
<p><span id="exm:unlabeled-div-129" class="example"><strong>Example 4.8  </strong></span>Let’s consider a more general simulation for hitting streaks. Suppose a hitter with a 0.300 batting average plays 140 games and has an equal likelihood of 3, 4, or 5 at-bats in a game. Simulate 10,000 seasons for this hitter, calculate the average max hitting streak, and the overall max hitting streak. After this, repeat the process for a hitter with a 0.400 batting average.</p>
</div>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="monte-carlo-simulation.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.300 Hitter Hitting Streak Simulation</span></span>
<span id="cb234-2"><a href="monte-carlo-simulation.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb234-3"><a href="monte-carlo-simulation.html#cb234-3" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb234-4"><a href="monte-carlo-simulation.html#cb234-4" aria-hidden="true" tabindex="-1"></a>n.games <span class="ot">&lt;-</span> <span class="dv">140</span></span>
<span id="cb234-5"><a href="monte-carlo-simulation.html#cb234-5" aria-hidden="true" tabindex="-1"></a>prob.hit <span class="ot">&lt;-</span> <span class="fl">0.300</span></span>
<span id="cb234-6"><a href="monte-carlo-simulation.html#cb234-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-7"><a href="monte-carlo-simulation.html#cb234-7" aria-hidden="true" tabindex="-1"></a>longest.streak <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n.sims)</span>
<span id="cb234-8"><a href="monte-carlo-simulation.html#cb234-8" aria-hidden="true" tabindex="-1"></a>sim.games <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.games)</span>
<span id="cb234-9"><a href="monte-carlo-simulation.html#cb234-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-10"><a href="monte-carlo-simulation.html#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> n.sims){</span>
<span id="cb234-11"><a href="monte-carlo-simulation.html#cb234-11" aria-hidden="true" tabindex="-1"></a>  sim.pa <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,<span class="at">size=</span>n.games,<span class="at">replace=</span>T)</span>
<span id="cb234-12"><a href="monte-carlo-simulation.html#cb234-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.games){</span>
<span id="cb234-13"><a href="monte-carlo-simulation.html#cb234-13" aria-hidden="true" tabindex="-1"></a>    sim.games[j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">1</span>,<span class="at">size =</span> sim.pa[j],<span class="at">prob =</span> prob.hit)</span>
<span id="cb234-14"><a href="monte-carlo-simulation.html#cb234-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-15"><a href="monte-carlo-simulation.html#cb234-15" aria-hidden="true" tabindex="-1"></a>  sim.hits <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sim.games <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb234-16"><a href="monte-carlo-simulation.html#cb234-16" aria-hidden="true" tabindex="-1"></a>  streaks <span class="ot">&lt;-</span> <span class="fu">rle</span>(sim.hits)</span>
<span id="cb234-17"><a href="monte-carlo-simulation.html#cb234-17" aria-hidden="true" tabindex="-1"></a>  longest.streak[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(streaks<span class="sc">$</span>lengths[streaks<span class="sc">$</span>values<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb234-18"><a href="monte-carlo-simulation.html#cb234-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb234-19"><a href="monte-carlo-simulation.html#cb234-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-20"><a href="monte-carlo-simulation.html#cb234-20" aria-hidden="true" tabindex="-1"></a>longest.streak <span class="sc">%&gt;%</span> </span>
<span id="cb234-21"><a href="monte-carlo-simulation.html#cb234-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb234-22"><a href="monte-carlo-simulation.html#cb234-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>longest.streak)) <span class="sc">+</span> </span>
<span id="cb234-23"><a href="monte-carlo-simulation.html#cb234-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb234-24"><a href="monte-carlo-simulation.html#cb234-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Longest Hitting Streak for 10,000 Simulated Seasons (0.300 AVG hitter)&quot;</span>) <span class="sc">+</span></span>
<span id="cb234-25"><a href="monte-carlo-simulation.html#cb234-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Max Hitting Streak in a Simulation Season&quot;</span>)</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="monte-carlo-simulation.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics for 10,000 simulations (0.300 batting average)</span></span>
<span id="cb235-2"><a href="monte-carlo-simulation.html#cb235-2" aria-hidden="true" tabindex="-1"></a>mean.streak <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak); mean.streak</span></code></pre></div>
<pre><code>## [1] 13.9355</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="monte-carlo-simulation.html#cb237-1" aria-hidden="true" tabindex="-1"></a>max.streak <span class="ot">&lt;-</span> <span class="fu">max</span>(longest.streak); max.streak</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<p><img src="textbook_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="monte-carlo-simulation.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics for 10,000 simulations (0.400 batting average)</span></span>
<span id="cb239-2"><a href="monte-carlo-simulation.html#cb239-2" aria-hidden="true" tabindex="-1"></a>mean.streak <span class="ot">&lt;-</span> <span class="fu">mean</span>(longest.streak); mean.streak</span></code></pre></div>
<pre><code>## [1] 23.1349</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="monte-carlo-simulation.html#cb241-1" aria-hidden="true" tabindex="-1"></a>max.streak <span class="ot">&lt;-</span> <span class="fu">max</span>(longest.streak); max.streak</span></code></pre></div>
<pre><code>## [1] 85</code></pre>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="gambling-simulations" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Gambling Simulations<a href="monte-carlo-simulation.html#gambling-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Simulation can be very helpful and useful in evaluating betting systems in (sports) gambling.</p>
<div id="martingale-system" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Martingale System<a href="monte-carlo-simulation.html#martingale-system" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One such famous betting system is called a martingale system. Under this system, the bettor makes an initial wager. If they lose, they make the same wager. If they lose again, they follow a <em>double or nothing</em> procedure. This means that the bettor will continue betting the amount they have lost until they eventually win and get back even. What is wrong with this system?</p>
<div class="example">
<p><span id="exm:unlabeled-div-130" class="example"><strong>Example 4.9  </strong></span>Suppose you are betting on sports matches on the spread where there is no house advantage, so all bets are 1:1 and each team is equally likely to win. You begin by wagering $1 and you lose the initial bet (call it <em>Bet Zero</em>). You decide to employee the martingale system. Calculate the expected number of bets that you would have to make to break even. Also, create a histogram for the the biggest deficits in the simulations.</p>
</div>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="monte-carlo-simulation.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb243-2"><a href="monte-carlo-simulation.html#cb243-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb243-3"><a href="monte-carlo-simulation.html#cb243-3" aria-hidden="true" tabindex="-1"></a>sim.bets <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,n.sims)</span>
<span id="cb243-4"><a href="monte-carlo-simulation.html#cb243-4" aria-hidden="true" tabindex="-1"></a>max.deficit <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,n.sims)</span>
<span id="cb243-5"><a href="monte-carlo-simulation.html#cb243-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-6"><a href="monte-carlo-simulation.html#cb243-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims ){</span>
<span id="cb243-7"><a href="monte-carlo-simulation.html#cb243-7" aria-hidden="true" tabindex="-1"></a>  bets <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb243-8"><a href="monte-carlo-simulation.html#cb243-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-9"><a href="monte-carlo-simulation.html#cb243-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>( <span class="dv">1</span> ){</span>
<span id="cb243-10"><a href="monte-carlo-simulation.html#cb243-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">rbernoulli</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="fl">0.5</span>) ){</span>
<span id="cb243-11"><a href="monte-carlo-simulation.html#cb243-11" aria-hidden="true" tabindex="-1"></a>      bets <span class="ot">&lt;-</span> bets <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb243-12"><a href="monte-carlo-simulation.html#cb243-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb243-13"><a href="monte-carlo-simulation.html#cb243-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span>;</span>
<span id="cb243-14"><a href="monte-carlo-simulation.html#cb243-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb243-15"><a href="monte-carlo-simulation.html#cb243-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb243-16"><a href="monte-carlo-simulation.html#cb243-16" aria-hidden="true" tabindex="-1"></a>  sim.bets[i] <span class="ot">&lt;-</span> bets</span>
<span id="cb243-17"><a href="monte-carlo-simulation.html#cb243-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb243-18"><a href="monte-carlo-simulation.html#cb243-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-19"><a href="monte-carlo-simulation.html#cb243-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sim.bets)</span></code></pre></div>
<pre><code>## [1] 1.9996</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="monte-carlo-simulation.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(sim.bets)</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="monte-carlo-simulation.html#cb247-1" aria-hidden="true" tabindex="-1"></a>sim.bets <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb247-2"><a href="monte-carlo-simulation.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>sim.bets)) <span class="sc">+</span> </span>
<span id="cb247-3"><a href="monte-carlo-simulation.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb247-4"><a href="monte-carlo-simulation.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Simulated Number of Money Bets to Break Even&quot;</span>) <span class="sc">+</span> </span>
<span id="cb247-5"><a href="monte-carlo-simulation.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of Bets&quot;</span>)</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
<p>On average, two bets were needed to be placed after <em>Bet Zero</em> to break even.</p>
<div style="page-break-after: always;"></div>
<p>In two simulations (out of 10,000 total simulations), 12 bets were needed to be made to break even after the initial failed bet, <em>Bet Zero</em>. The first bet after <em>Bet Zero</em> was for $1. The second failed bet was from $2. The twelfth bet was for <span class="math inline">\(\$2^{11} = \$2048\)</span>. If your total bankroll was $1000, you wouldn’t have been even able to make the twelfth bet to break even. The weakness of the martingale system is that you are only guaranteed (with probability 1) to break even if you have an infinite bankroll.</p>
<p>The distribution in this example should look familiar. It is the geometric distribution. Let’s plot the probability mass function for a Geometric(0.5) random variable and calculate the probability that 12 or more bets are required to break even.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="monte-carlo-simulation.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">transform</span>(<span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">15</span>)), <span class="at">y=</span><span class="fu">dgeom</span>(x, <span class="at">prob =</span> <span class="fl">0.5</span>)), <span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb248-2"><a href="monte-carlo-simulation.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb248-3"><a href="monte-carlo-simulation.html#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Probability mass function of Geometric(0.5) random variable&quot;</span>) <span class="sc">+</span></span>
<span id="cb248-4"><a href="monte-carlo-simulation.html#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Value&quot;</span>, <span class="at">y=</span><span class="st">&quot;Frequency&quot;</span>, )</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="monte-carlo-simulation.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recall that R counts the number of failures before a success, </span></span>
<span id="cb249-2"><a href="monte-carlo-simulation.html#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co"># so we will be looking for at least 11 failures</span></span>
<span id="cb249-3"><a href="monte-carlo-simulation.html#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pgeom</span>(<span class="at">q=</span><span class="dv">11</span>,<span class="at">prob=</span><span class="fl">0.5</span>,<span class="at">lower.tail=</span>F)</span></code></pre></div>
<pre><code>## [1] 0.0002441406</code></pre>
<p>There is a 0.02% chance that we will need to make 12 or more wagers. In other words, if your bankroll is $1000, there is a 0.02% you lose the full bankroll before you can break even.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="gamblers-ruin" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Gambler’s Ruin<a href="monte-carlo-simulation.html#gamblers-ruin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The previous example is an ideal case where there is no house advantage. Sportsbooks will always have a house advantage, so it is more practical to consider an example where there is house advantage. For example, a point spread bet at -110 for two evenly matched teams will offer the sportsbook a house advantage.</p>
<div class="example">
<p><span id="exm:unlabeled-div-131" class="example"><strong>Example 4.10  </strong></span>Suppose you have a bankroll of $1000 and place $20 bets on point spread bets at -110. You will stop if you ever have less than $20. Assume that both teams are equally likely to beat the spread. How long will your bankroll last? Calculate your expected bankroll after 10 bets, 100 bets, and 1000 bets.</p>
</div>
<p>We’ll use the following code and run simulations with total.bets = 10, 100, 1000, 10000.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="monte-carlo-simulation.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb251-2"><a href="monte-carlo-simulation.html#cb251-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb251-3"><a href="monte-carlo-simulation.html#cb251-3" aria-hidden="true" tabindex="-1"></a>bankroll.end <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb251-4"><a href="monte-carlo-simulation.html#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="monte-carlo-simulation.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="co"># betting info</span></span>
<span id="cb251-6"><a href="monte-carlo-simulation.html#cb251-6" aria-hidden="true" tabindex="-1"></a>bankroll.start <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb251-7"><a href="monte-carlo-simulation.html#cb251-7" aria-hidden="true" tabindex="-1"></a>wager <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb251-8"><a href="monte-carlo-simulation.html#cb251-8" aria-hidden="true" tabindex="-1"></a>ml <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">110</span></span>
<span id="cb251-9"><a href="monte-carlo-simulation.html#cb251-9" aria-hidden="true" tabindex="-1"></a>total.bets <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb251-10"><a href="monte-carlo-simulation.html#cb251-10" aria-hidden="true" tabindex="-1"></a>implied.prob <span class="ot">&lt;-</span> (<span class="sc">-</span>ml)<span class="sc">/</span>(<span class="sc">-</span>ml<span class="sc">+</span><span class="dv">100</span>)</span>
<span id="cb251-11"><a href="monte-carlo-simulation.html#cb251-11" aria-hidden="true" tabindex="-1"></a>dec.odds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>implied.prob</span>
<span id="cb251-12"><a href="monte-carlo-simulation.html#cb251-12" aria-hidden="true" tabindex="-1"></a>profit <span class="ot">&lt;-</span> wager <span class="sc">*</span> (dec.odds <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb251-13"><a href="monte-carlo-simulation.html#cb251-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-14"><a href="monte-carlo-simulation.html#cb251-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb251-15"><a href="monte-carlo-simulation.html#cb251-15" aria-hidden="true" tabindex="-1"></a>  bets <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb251-16"><a href="monte-carlo-simulation.html#cb251-16" aria-hidden="true" tabindex="-1"></a>  bankroll <span class="ot">&lt;-</span> bankroll.start</span>
<span id="cb251-17"><a href="monte-carlo-simulation.html#cb251-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(bankroll <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;&amp;</span> bets <span class="sc">&lt;</span> total.bets){</span>
<span id="cb251-18"><a href="monte-carlo-simulation.html#cb251-18" aria-hidden="true" tabindex="-1"></a>    bets <span class="ot">&lt;-</span> bets <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb251-19"><a href="monte-carlo-simulation.html#cb251-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">rbernoulli</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="fl">0.5</span>) ){</span>
<span id="cb251-20"><a href="monte-carlo-simulation.html#cb251-20" aria-hidden="true" tabindex="-1"></a>      bankroll <span class="ot">&lt;-</span> bankroll <span class="sc">+</span> profit</span>
<span id="cb251-21"><a href="monte-carlo-simulation.html#cb251-21" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span></span>
<span id="cb251-22"><a href="monte-carlo-simulation.html#cb251-22" aria-hidden="true" tabindex="-1"></a>      bankroll <span class="ot">&lt;-</span> bankroll <span class="sc">-</span> <span class="dv">20</span></span>
<span id="cb251-23"><a href="monte-carlo-simulation.html#cb251-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb251-24"><a href="monte-carlo-simulation.html#cb251-24" aria-hidden="true" tabindex="-1"></a>  bankroll.end[i] <span class="ot">&lt;-</span> bankroll</span>
<span id="cb251-25"><a href="monte-carlo-simulation.html#cb251-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb251-26"><a href="monte-carlo-simulation.html#cb251-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-27"><a href="monte-carlo-simulation.html#cb251-27" aria-hidden="true" tabindex="-1"></a>mean.ending.bankroll <span class="ot">&lt;-</span> <span class="fu">mean</span>(bankroll.end)</span>
<span id="cb251-28"><a href="monte-carlo-simulation.html#cb251-28" aria-hidden="true" tabindex="-1"></a>max.ending.bankroll <span class="ot">&lt;-</span> <span class="fu">max</span>(bankroll.end)</span>
<span id="cb251-29"><a href="monte-carlo-simulation.html#cb251-29" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(mean.ending.bankroll,max.ending.bankroll) <span class="sc">%&gt;%</span> <span class="fu">kt</span>()</span>
<span id="cb251-30"><a href="monte-carlo-simulation.html#cb251-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-31"><a href="monte-carlo-simulation.html#cb251-31" aria-hidden="true" tabindex="-1"></a>bankroll.end <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb251-32"><a href="monte-carlo-simulation.html#cb251-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>bankroll.end)) <span class="sc">+</span> </span>
<span id="cb251-33"><a href="monte-carlo-simulation.html#cb251-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb251-34"><a href="monte-carlo-simulation.html#cb251-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Simulated Bankroll (starting at $1000) after 10 bets&quot;</span>) <span class="sc">+</span> </span>
<span id="cb251-35"><a href="monte-carlo-simulation.html#cb251-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bankroll after 10 bets&quot;</span>)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Number of Bets
</th>
<th style="text-align:center;">
Mean Ending Bankroll
</th>
<th style="text-align:center;">
Max Ending Payroll
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
991.707
</td>
<td style="text-align:center;">
1181.818
</td>
</tr>
<tr>
<td style="text-align:center;">
100
</td>
<td style="text-align:center;">
909.599
</td>
<td style="text-align:center;">
1672.727
</td>
</tr>
<tr>
<td style="text-align:center;">
1000
</td>
<td style="text-align:center;">
274.529
</td>
<td style="text-align:center;">
2572.727
</td>
</tr>
</tbody>
</table>
<p><img src="textbook_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p>All bettors eventually go broke under this scenario due to the house advantage. This is called the concept of <strong>Gambler’s Ruin</strong>. A gambler playing a game with negative expected value will eventually go broke, regardless of their betting system.</p>
<p>See Wikipedia for further details: <a href="https://en.wikipedia.org/wiki/Gambler&#39;s_ruin" class="uri">https://en.wikipedia.org/wiki/Gambler's_ruin</a></p>
</div>
<div id="simulating-a-winning-system" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Simulating a Winning System<a href="monte-carlo-simulation.html#simulating-a-winning-system" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="example">
<p><span id="exm:unlabeled-div-132" class="example"><strong>Example 4.11  </strong></span>Suppose your betting system allows you pick winners on the spread 55% of the time. If you are betting at -110, then your probability exceeds the implied probability of 52.4% and this system is not guaranteed to be an eventual loser. Repeat the simulation above with the new probability of winning a wager and 1,000 total bets.</p>
</div>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="monte-carlo-simulation.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb252-2"><a href="monte-carlo-simulation.html#cb252-2" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb252-3"><a href="monte-carlo-simulation.html#cb252-3" aria-hidden="true" tabindex="-1"></a>bankroll.end <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,n.sims)</span>
<span id="cb252-4"><a href="monte-carlo-simulation.html#cb252-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-5"><a href="monte-carlo-simulation.html#cb252-5" aria-hidden="true" tabindex="-1"></a><span class="co"># betting info</span></span>
<span id="cb252-6"><a href="monte-carlo-simulation.html#cb252-6" aria-hidden="true" tabindex="-1"></a>bankroll.start <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb252-7"><a href="monte-carlo-simulation.html#cb252-7" aria-hidden="true" tabindex="-1"></a>wager <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb252-8"><a href="monte-carlo-simulation.html#cb252-8" aria-hidden="true" tabindex="-1"></a>ml <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">110</span></span>
<span id="cb252-9"><a href="monte-carlo-simulation.html#cb252-9" aria-hidden="true" tabindex="-1"></a>total.bets <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb252-10"><a href="monte-carlo-simulation.html#cb252-10" aria-hidden="true" tabindex="-1"></a>implied.prob <span class="ot">&lt;-</span> (<span class="sc">-</span>ml)<span class="sc">/</span>(<span class="sc">-</span>ml<span class="sc">+</span><span class="dv">100</span>)</span>
<span id="cb252-11"><a href="monte-carlo-simulation.html#cb252-11" aria-hidden="true" tabindex="-1"></a>dec.odds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>implied.prob</span>
<span id="cb252-12"><a href="monte-carlo-simulation.html#cb252-12" aria-hidden="true" tabindex="-1"></a>profit <span class="ot">&lt;-</span> wager <span class="sc">*</span> (dec.odds <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb252-13"><a href="monte-carlo-simulation.html#cb252-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-14"><a href="monte-carlo-simulation.html#cb252-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb252-15"><a href="monte-carlo-simulation.html#cb252-15" aria-hidden="true" tabindex="-1"></a>  bets <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb252-16"><a href="monte-carlo-simulation.html#cb252-16" aria-hidden="true" tabindex="-1"></a>  bankroll <span class="ot">&lt;-</span> bankroll.start</span>
<span id="cb252-17"><a href="monte-carlo-simulation.html#cb252-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(bankroll <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;&amp;</span> bets <span class="sc">&lt;</span> total.bets){</span>
<span id="cb252-18"><a href="monte-carlo-simulation.html#cb252-18" aria-hidden="true" tabindex="-1"></a>    bets <span class="ot">&lt;-</span> bets <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb252-19"><a href="monte-carlo-simulation.html#cb252-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">rbernoulli</span>(<span class="at">n=</span><span class="dv">1</span>,<span class="fl">0.55</span>) ){</span>
<span id="cb252-20"><a href="monte-carlo-simulation.html#cb252-20" aria-hidden="true" tabindex="-1"></a>      bankroll <span class="ot">&lt;-</span> bankroll <span class="sc">+</span> profit</span>
<span id="cb252-21"><a href="monte-carlo-simulation.html#cb252-21" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span></span>
<span id="cb252-22"><a href="monte-carlo-simulation.html#cb252-22" aria-hidden="true" tabindex="-1"></a>      bankroll <span class="ot">&lt;-</span> bankroll <span class="sc">-</span> <span class="dv">20</span></span>
<span id="cb252-23"><a href="monte-carlo-simulation.html#cb252-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb252-24"><a href="monte-carlo-simulation.html#cb252-24" aria-hidden="true" tabindex="-1"></a>  bankroll.end[i] <span class="ot">&lt;-</span> bankroll</span>
<span id="cb252-25"><a href="monte-carlo-simulation.html#cb252-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb252-26"><a href="monte-carlo-simulation.html#cb252-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-27"><a href="monte-carlo-simulation.html#cb252-27" aria-hidden="true" tabindex="-1"></a>mean.ending.bankroll <span class="ot">&lt;-</span> <span class="fu">mean</span>(bankroll.end)</span>
<span id="cb252-28"><a href="monte-carlo-simulation.html#cb252-28" aria-hidden="true" tabindex="-1"></a>max.ending.bankroll <span class="ot">&lt;-</span> <span class="fu">max</span>(bankroll.end)</span>
<span id="cb252-29"><a href="monte-carlo-simulation.html#cb252-29" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(mean.ending.bankroll,max.ending.bankroll) <span class="sc">%&gt;%</span> <span class="fu">kt</span>()</span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
mean.ending.bankroll
</th>
<th style="text-align:center;">
max.ending.bankroll
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1996.283
</td>
<td style="text-align:center;">
4634.545
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="monte-carlo-simulation.html#cb253-1" aria-hidden="true" tabindex="-1"></a>bankroll.end <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb253-2"><a href="monte-carlo-simulation.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>bankroll.end)) <span class="sc">+</span> </span>
<span id="cb253-3"><a href="monte-carlo-simulation.html#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb253-4"><a href="monte-carlo-simulation.html#cb253-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Simulated Bankroll (starting at $1000) after 1000 bets&quot;</span>) <span class="sc">+</span> </span>
<span id="cb253-5"><a href="monte-carlo-simulation.html#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bankroll after 1000 bets&quot;</span>)</span></code></pre></div>
<p><img src="textbook_files/figure-html/unnamed-chunk-102-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="case-study-evaluating-hitters" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Case Study: Evaluating Hitters<a href="monte-carlo-simulation.html#case-study-evaluating-hitters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(Mathletics chapter 4, page 31)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="probability.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="statistical-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aaron-nielsen/SportsAnalyticsBook/edit/master/03-simulation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["textbook.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
