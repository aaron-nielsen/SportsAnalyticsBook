[["monte-carlo-simulation.html", "Chapter 3 Monte Carlo Simulation 3.1 Basics 3.2 Estimating Probabilities Using Simulation 3.3 A few reminders/tips for simulation, and a basic example 3.4 Streak Simulation - Basketball", " Chapter 3 Monte Carlo Simulation 3.1 Basics Monte Carlo Simulation is a collection of computer-driven, computational algorithms that use repeated random sampling to calculate estimates. The basic steps for such a simulation are as follows: Initialize vectors and variables Run a simulation and calculate the estimate of interest Save the estimate Run the simulation “n” times Analyze the estimates from the “n” simulations One function that will be particularly useful for simulation is set.seed(). set.seed() allows us to replicate any simulation by giving the initial seed for the simulation. The actual number that is “seeded” is not particularly important though if you want to replicate the same simulations, you will want to re-use this number. Example 3.1 Simulate 10 overtime coin tosses with and without using set.seed() and compare the results # Sample 1 sample(c(&quot;H&quot;,&quot;T&quot;),size=10,prob=c(0.5,0.5),replace=T) ## [1] &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;H&quot; # Sample 2 sample(c(&quot;H&quot;,&quot;T&quot;),size=10,prob=c(0.5,0.5),replace=T) ## [1] &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; # Sample 3 set.seed(2020) sample(c(&quot;H&quot;,&quot;T&quot;),size=10,prob=c(0.5,0.5),replace=T) ## [1] &quot;H&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; # Sample 4 set.seed(2020) sample(c(&quot;H&quot;,&quot;T&quot;),size=10,prob=c(0.5,0.5),replace=T) ## [1] &quot;H&quot; &quot;T&quot; &quot;H&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;T&quot; &quot;H&quot; Simulation can be very helpful when you want to estimate quantities that are not easily solved using analytical methods like formulas. Example 3.2 Shaquille O’Neal has a career free throw percentage of 52.7%. Suppose that Shaq takes 10 free throw shots. What is the probability that he makes all 10 shots? set.seed(2020) # Number of Simulations n.sims &lt;- 10000 # Initialize FT variable with 10000 zeros FT &lt;- rep(0,n.sims) for(i in 1:n.sims){ # Simulate 10 free throws temp &lt;- sample(x=c(0,1), size = 10, replace = T, prob = c(0.473,0.527) ) # Count the number of free throws made and store them in FT FT[i] &lt;- sum(temp) } c(mean(FT),var(FT)) ## [1] 5.33660 2.49375 FT %&gt;% as.data.frame() %&gt;% ggplot(aes(x=FT)) + geom_bar() prob10 &lt;- sum(FT == 10)/n.sims; prob10 ## [1] 0.0023 The estimated probability that Shaq goes 10-for-10 in free throw attempts based on his career average is 0.0023. If we run the simulation again with a different seed, we will get another estimate (0.0019). set.seed(1) # Number of Simulations n.sims &lt;- 10000 # Initialize FT variable with 10000 zeros FT &lt;- rep(0,n.sims) for(i in 1:n.sims){ # Simulate 10 free throws temp &lt;- sample(x=c(0,1), size = 10, replace = T, prob = c(0.473,0.527) ) # Count the number of free throws made and store them in FT FT[i] &lt;- sum(temp) } prob10 &lt;- sum(FT == 10)/n.sims; prob10 ## [1] 0.0019 In this case, we could have also calculated the exact probability of interest (0.00165) using binomial random variable. dbinom(x=10,size=10,prob=0.527) ## [1] 0.001652366 In more complicated simulations, there may not be an easy formula to use to calculate the value of interest. In these situations, simulation can be very helpful in estimating quantities. Example 3.3 In 1997-1998 with the Los Angeles Lakers, Shaq attempted an average of 11.35 free throws per game with a standard deviation of 4.04. While with the Lakers, Shaq played in an average of 63.6 games per year with a standard deviation of 10.6. What is the expected number of free throws that Shaq would make in a season using these numbers? Note: his actual season totals of free throws attempted while with the Lakers were: 479, 681, 498, 824, 972, 712, 725, 676 set.seed(2020) n.sims &lt;- 10000 FT &lt;- rep(0,n.sims) games.mean &lt;- 63.6 games.sd &lt;- 10.6 ft.mean &lt;- 11.35 ft.sd &lt;- 4.04 # simulate the number of games played in a season, round to a whole number games.sim &lt;- round( rnorm(n=n.sims,mean = games.mean, sd = games.sd)) # number of games can&#39;t be negative games.sim[games.sim&lt;0] = 0 # number of games can&#39;t exceed 82 games (regular season total) games.sim[games.sim&gt;82] = 82 for(i in 1:n.sims){ # simulate the season total FT attempts in each simulation temp &lt;- round( rnorm(n = games.sim[i],mean = ft.mean, sd = ft.sd)) FT[i] &lt;- sum(temp) } # Simulated mean and SD of season totals of free throw attempts c(mean(FT),sd(FT)) ## [1] 718.9101 119.9752 # Actual mean and SD of season totals of free throw attempts FT.actual &lt;- c(479, 681, 498, 824, 972, 712, 725, 676) c(mean(FT.actual),sd(FT.actual)) ## [1] 695.8750 160.6126 FT %&gt;% as.data.frame() %&gt;% ggplot(aes(x=FT)) + geom_histogram(bins=30,color = &quot;yellow&quot;, fill = &quot;purple&quot;) + ggtitle(&quot;Simulated Season FT Attempt Totals by Shaq with Lakers&quot;) One reason that you may want to do complicated simulations like the example above is to make predictions for a player’s future seasons. 3.2 Estimating Probabilities Using Simulation We can use simulation to estimate probabilities of different events occurring. One way to do this is for each simulation to record a “1” if the event of interest occurs and a “0” if the event of interest does not occur. Definition 3.1 The indicator function, \\(I(A)\\), is defined such that \\(I(A)\\) is equal to 1 if \\(A\\) occurs and is equal to 0 if \\(A\\) does not occur. For instance, suppose we roll a die and a “6” is on top. Then we have the following: \\(I(6)=1, I(5)=0, I(even)=1, I(odd)=0\\). One way to calculate probabilities is to use the following rule: \\(P(A) = E[I(A)]\\). The probability that \\(A\\) occurs is equal to the expected value of the indicator function of \\(A\\). Example 3.4 During the 2021 WNBA season, Kahleah Copper of the Chicago Sky had a free throw percentage of 81.8%. She played a total of 32 games and the probability mass function for number of free throw attempts per game are given in the table below. Estimate the probability that Copper did not make a free throw in a game. [Note: Copper did not make a free throw in 6 out of the 32 games for a probability of 0.1875.] Free Throw Attempts Per Game, FTA 0.00000 1.0000 2.00 3 4.00000 5.0000 6.000 7.0000 8.0000 Number of Occurrences, nFTA 5.00000 2.0000 8.00 0 7.00000 2.0000 4.000 2.0000 2.0000 Probability, p(FTA) 0.15625 0.0625 0.25 0 0.21875 0.0625 0.125 0.0625 0.0625 set.seed(2020) n.sims &lt;- 10000 games &lt;- 32 FTprob &lt;- 0.818 FTA &lt;- 0:8 nFTA &lt;- c(5,2,8,0,7,2,4,2,2) pFTA &lt;- nFTA/32 FT &lt;- rep(0, n.sims) FT0.ind &lt;- rep(0,n.sims) # Simulate the number of FTA per game FTA.sim &lt;- sample(x = FTA,size = n.sims,replace = T,prob = pFTA) # Simulate 10,000 games and record number of FT made for(i in 1:n.sims){ FT[i] &lt;- rbinom(n=1,size = FTA.sim[i],prob = 0.818) } # Look at the header of the simulated data head(FT) ## [1] 6 3 0 0 1 1 # Create indicator function for 0 FT made FT0.ind = FT == 0 head(FT0.ind) ## [1] FALSE FALSE TRUE TRUE FALSE FALSE # Estimate probability of 0 FT made sum(FT0.ind)/n.sims ## [1] 0.1711 3.3 A few reminders/tips for simulation, and a basic example The number of regulation goals scored in a game by Hockey Team A, \\(X\\), is a Poisson(4) random variable, and the same for Hockey Team B, \\(Y\\), is a Poisson(3.2) random variable. A statistician is interested in the probability that Team A defeats Team B in regulation. This is \\(P(X &gt; Y)\\), which is difficult to calculate manually. However, using simulation, we can straightforwardly obtain an accurate estimation of this quantity. There are many built-in functions in R that allow users to generate realizations from common probability distributions (rnorm, rbinom, rexp, etc.) Let’s use the rpois function to simulate the appropriate variables, remembering to set a seed so that our results are easily replicable. set.seed(2022) nReps &lt;- 1e4 team_A_goals &lt;- rpois(n = nReps, lambda = 4) team_B_goals &lt;- rpois(n = nReps, lambda = 3.2) Now, to find \\(P(X &gt; Y)\\), we can use the following line of code: mean(team_A_goals &gt; team_B_goals) ## [1] 0.5415 Why does this work? First, operations to vectors are executed elementwise, meaning that R compares team_A_goals[1] to team_B_goals[1], then team_A_goals[2] to team_B_goals[2], and so on. Second, logical operators are stored as zeroes (when the condition is false) and ones (when the condition is true). The mean of a vector of zeroes and ones is the proportion of ones, which is the frequency of the logical statement being true. In our simulation, it was 0.5415. The true value is 0.5427, meaning that the simulation was quite accurate. These tips will help you be more efficient when performing simulation tasks in R. 3.4 Streak Simulation - Basketball Suppose an NBA team is in the middle of a rebuild and has a 25% probability of winning each of its games in the following 82-game season. Q: What is the probability that the team will go on at least one winning streak of four or more games over the course of the 82-game season? A: We can simulate a season for the team, find the longest winning streak in that season, and store it in a vector. After repeating that process 10,000 times, we can then find the proportion of the values in that vector that are greater than or equal to 4. set.seed(2022) nReps &lt;- 1e4 longest_streak &lt;- rep(NA, nReps) for (i in 1:nReps) { game_results &lt;- rbinom(size = 1, n = 82, prob = .25) # 1=win, 0=loss streaks &lt;- rle(game_results) longest_streak[i] &lt;- max(streaks$lengths[streaks$values==1]) } table(longest_streak) ## longest_streak ## 1 2 3 4 5 6 7 8 9 ## 116 3626 4233 1480 410 105 21 7 2 mean(longest_streak &gt;= 4) ## [1] 0.2025 The team had a 4+ game winning streak in about 20% of the simulations. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
